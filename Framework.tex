\section{A Framework built on pandas}
\label{framework}

There are several motivations for building an analysis framework around the \code{pandas DataFrame}. 
The guiding principle underlying the design of this framework is to enable exploratory investigation.
This requires both intelligent memory management for handling out-of-core datasets, and a robust indexing system to ensure that particle properties do not become misaligned in memory.
Using  the \code{pandas DataFrame} as the primary data container rather than separate \code{numpy} arrays makes it much easier to keep different particle properties indexed correctly while still affording the flexibility to load and remove data from memory at will.
In addition, \code{pandas} itself is a thoroughly documented, open-source, BSD-licensed library providing high-performance, easy-to-use data structures and analysis tools, and has a strong community of developers working to improve it.  
More broadly, as \code{pandas} is becoming the de-facto standard for data analysis in python, doing so simplifies interoperability with the rest of the tools in the ecosystem.


\subsection{Snapshot--DataFrame Interface}
\label{interface}

The framework makes some assumptions about how the simulation output is organized.  Each particle type is expected to be contained in a different group, labeled PartType0, PartType1, etc. An additional group, Header, is also expected, containing metadata for the simulation snapshot as hdf5 attributes.  

\subsection{Organizational Structure}
\label{hierarchy}

Data for each particle type (e.g., dark matter, gas, etc.) is stored in a separate DataFrame and indexed by particle number.  Individual fields can be loaded into the dataframes and deleted at will, with coherent slicing across multiple data fields.   These DataFrame objects, loaded as needed from disk, are then gathered in a snapshot object, along with the header information, and any other snapshot-specific metadata.  Metadata relevant to the simulation as a whole is then gathered in a simulation class, which also implements batch processing methods.

\subsection{Units and physical constants}
\label{units}
Physical constants are imported from astropy, where necessary.  Unit conversions are dealt with in a similar manner; unfortunately pandas DataFrames do not play nice with astropy quantities, and so the unit system included here is rudimentary at best.

\subsection{Coordinate Transformations}
\label{coordinates}
pyGadget includes a coordinate module for converting between cartesian, spherical, and cylindrical coordinates, linear coordinate translation, and arbitrary axis rotation.